<head>
	<meta charset="utf-8"/>
	<title>Trace-Spector</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- styles -->
	<script src="/assets/js/es5.js"></script>
	<script src="/assets/js/dom.js"></script>
	<script src="/assets/js/package.js"></script>
	<script src="/assets/js/HTMLImports.js"></script>

	<link href='http://fonts.googleapis.com/css?family=Roboto:500,300,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' async>

	<!-- icons -->
	<link rel="icon" type="image/png" href="/assets/ico/24.png" sizes="24x24">
	<link rel="icon" type="image/png" href="/assets/ico/128.png" sizes="128x128">

	<link rel="shortcut icon" href="/assets/ico/24.png">
</head>
<body>
	<canvas id="view"></canvas>
</body>

<link rel="import" href="/ts/model.html">
<link rel="import" href="/ts/render.html">

<script>
var canvas = document.getElementById("view");
canvas.width = 600;
canvas.height = 480;

var context = canvas.getContext("2d");
var timeline = new ts.Timeline();

canvas.onwheel = function(ev){
	timeline.zoom(ev.layerX / canvas.width, ev.wheelDeltaY/240);
};

canvas.onmousemove = function(ev){
	if(ev.which === 1){
		timeline.drag(-ev.movementX / canvas.width)
	}
};

function loop(){
	var size = {x:600, y:480};
	context.clearRect(0,0,size.x,size.y);
	ts.render(context, timeline, size);
	window.requestAnimationFrame(loop);
}
loop();

var xhr = new XMLHttpRequest();
xhr.open("GET", "/data/data.flow.json");
xhr.onload = function(ev){
	var events = JSON.parse(xhr.responseText);
	timeline.load(events);
	xhr = null;
	events = null;
};
xhr.send();

</script>
<style>
#view {
	box-sizing: border-box;
	width: 600px;
	height: 480px;
	border: 1px solid #ccc;
}
</style>
</html>